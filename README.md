## Voice Dictation — быстрый диктант с авто‑вставкой текста (macOS, Electron)

Ежедневный инструмент для диктовки: по горячей клавише открывается компактное окно записи, ваше голосовое сообщение распознаётся с помощью выбранного AI‑сервиса (OpenAI или Google), а итоговый текст автоматически вставляется в активное приложение и фокус возвращается туда же. Удобно для заметок, писем, тикетов, TODO и любой повседневной рутины.

### Dictation app for macOS (voice to text, speech to text)

Fast dictation app for macOS built with Electron. Transcribe speech to text using OpenAI or Google and auto‑insert the result into any app. Keywords: dictation app macOS, voice to text macOS, speech to text for Mac.

### Скачать для macOS

- Готовый установщик `.dmg` для macOS ищите в разделе Releases репозитория.
- Либо соберите локально (см. ниже «Сборка релиза (macOS)»).

### Возможности

- **Горячая клавиша**: ⌘ + Shift + D (macOS).
- **Автопунктуация на русском**: нейросеть сразу ставит знаки препинания.
- **Авто‑фокус**: окно диктовки появляется поверх всех окон и скрывается после вставки.
- **Два провайдера распознавания речи**:
  - OpenAI `gpt-4o-transcribe`
  - Google Gemini `2.5 Flash` (через `@google/genai`)
- **Два метода вставки текста**:
  - Через буфер обмена и эмуляцию вставки (меню Edit → Paste или Cmd+V).
  - Прямой ввод символов через системные события macOS (подходит в основном для латиницы).
- **Повтор запросов** при сетевых/серверных сбоях (экспоненциальная задержка).
- **Локальное хранение настроек** (ключи и параметры в `electron-store`).
- **Системный трей**: быстрый доступ к старту диктовки и настройкам.

### Как это работает

1. Нажмите ⌘ + Shift + D — показывается небольшое окно записи по центру экрана.
2. Нажмите на кнопку с микрофоном — начинается запись с отображением таймера.
3. По повторному нажатию запись завершается и аудио сохраняется во временный файл (`.webm`).
4. Аудио отправляется в выбранный AI‑провайдер, выполняется транскрипция.
5. Приложение возвращает фокус в предыдущее активное приложение и выполняет вставку текста:
   - Через буфер обмена (меню Paste/Вставить или Cmd+V), затем буфер восстанавливается.
   - Либо прямым вводом символов (по настройке).
6. Окно диктовки скрывается; вы продолжаете работу в том же месте, где были.

### Интерфейс

- Главное окно (frameless, всегда поверх) с кнопкой записи, статусом, таймером и кнопкой Отмена.
- Кнопка настроек открывает отдельное окно.
- Иконка и меню в системном трее (доступ к старту диктовки и настройкам).

### Настройки

Откройте окно настроек через кнопку ⚙️ или из меню трея.

- **AI Провайдер**: OpenAI или Google.
- **Ключи API**: `OpenAI API key` и/или `Google API key`.
- **Язык распознавания**: список популярных языков по умолчанию.
- **Метод вставки текста**:
  - Clipboard (рекомендуется): работает стабильно, подходит для любых языков.
  - Direct input: эмуляция набора текста; ожидаемо лучше для латиницы.
- **Горячая клавиша**: ⌘ + Shift + D (фиксированная в текущей версии).

Ключи и настройки сохраняются локально через `electron-store`.

### Требования и разрешения macOS

- Разрешение на доступ к микрофону (запросит автоматически при первом запуске записи).
- Разрешение в разделе «Специальные возможности» (Accessibility) — нужно для автоматической вставки текста (Cmd+V/меню/эмуляция ввода):
  - Системные настройки → Конфиденциальность и безопасность → Специальные возможности → добавьте и включите `Electron`/приложение.

### Установка и запуск для разработки

```bash
npm install
npm run start
```

Альтернатива с флагом разработки:

```bash
npm run dev
```

### Сборка релиза (macOS)

```bash
npm run dist
```

Сборка выполняется `electron-builder` и создаёт `.dmg` и `.zip` в каталоге `dist/`.

Основные параметры сборки:

- `appId`: `com.example.voicedictation`
- `productName`: `Voice Dictation`
- Иконка: `build/DictionApp.icns`

### Горячие клавиши

- Показать/скрыть диктовку: **⌘ + Shift + D** (macOS).  
  Если сочетание занято другой программой, отключите конфликт или переопределите его там.

### Технические детали

- Платформа: **Electron 27**
- Хранилище настроек: **electron-store**
- AI‑клиенты:
  - **OpenAI** (`openai`): используется метод `audio.transcriptions.create` с моделью `gpt-4o-transcribe`.
  - **Google** (`@google/genai`): `files.upload` + `models.generateContent` (модель `gemini-2.5-flash`).
- Логика ретраев: до 3 попыток с экспоненциальной задержкой, отмена по `AbortController`.
- Работа с фокусом приложений и вставкой: AppleScript через `osascript`, меню Edit → Paste/Вставить, либо имитация Cmd+V. При прямом вводе — отправка символов через системные события.
- Безопасность буфера обмена: содержимое сохраняется и восстанавливается после вставки.

### Файловая структура (основное)

```
src/
  main.js                 # главные процессы: окна, трей, шорткаст, IPC, вставка
  renderer/
    index.html            # UI окна диктовки
    renderer.js           # запись, таймер, транскрипция, IPC и состояния
    styles.css            # стили окна диктовки
    settings.html         # UI настроек
    settings.js           # логика настроек и сохранение через IPC
    settings.css          # стили настроек
build/
  DictionApp.icns         # иконка приложения
```

### Icon

![Dictation app for macOS — Voice Dictation](./DictionApp.png)

### Диагностика и советы

- **Нет вставки текста**: проверьте разрешение «Специальные возможности». Попробуйте метод вставки Clipboard. Убедитесь, что фокус возвращается в нужное окно.
- **API ошибки (429/5xx/сеть)**: проверьте ключи/квоты/интернет. Встроенные повторы выполняются автоматически, но постоянная ошибка требует ручного вмешательства.
- **Микрофон**: дайте доступ приложению к микрофону в Системных настройках → Конфиденциальность.
- **Конфликт горячих клавиш**: освободите сочетание в другой программе.

### Ограничения

- Текущая версия ориентирована на **macOS** (используются AppleScript и системные события).
- Метод прямого ввода символов ожидаемо надёжнее для **латиницы**; для кириллицы и иероглифов рекомендуется метод Clipboard.

### Идеи для развития

- Кастомизация горячих клавиш внутри приложения.
- История диктовок и быстрый повтор вставки.
- Авто‑постобработка текста (пунктуация, стиль, формат заметок).
- Поддержка Windows/Linux с аналогами системных событий.

### Лицензия

MIT
